<!-- ======================
 ğŸ“Š Statistik Laporan Manual (Punya Kamu Awal)
====================== -->
<h2>ğŸ“Š Statistik Laporan Manual</h2>
<canvas id="chartLaporan" width="400" height="200"></canvas>

<!-- ======================
 ğŸ“Š Statistik Sistem (Realtime)
====================== -->
<h2>ğŸ“Š Statistik Sistem (Realtime)</h2>
<canvas id="chartSistem" width="400" height="200"></canvas>

<!-- ======================
 ğŸ“ˆ Histori Deteksi Sistem
====================== -->
<h2>ğŸ“ˆ Histori Deteksi Sistem</h2>
<canvas id="chartHistory" width="600" height="300"></canvas>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

  // ======================
  // ğŸ”¹ Firebase Config (punyamu yg lama, jangan dihapus)
  // ======================
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "laporan-lalu-lintas.firebaseapp.com",
    databaseURL: "https://laporan-lalu-lintas-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "laporan-lalu-lintas",
    storageBucket: "laporan-lalu-lintas.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ======================
  // ğŸ”¹ Chart Laporan Manual (Punya Kamu)
  // ======================
  const chartLaporan = new Chart(document.getElementById("chartLaporan"), {
    type: "bar",
    data: {
      labels: ["Lancar", "Macet"],
      datasets: [{
        label: "Jumlah Laporan",
        data: [0, 0],
        backgroundColor: ["#4caf50", "#f44336"]
      }]
    }
  });

  onValue(ref(db, "laporan"), (snapshot) => {
    const data = snapshot.val();
    let lancar = 0, macet = 0;

    if (data) {
      Object.values(data).forEach(item => {
        if (item.status === "lancar") lancar++;
        if (item.status === "macet") macet++;
      });
    }

    chartLaporan.data.datasets[0].data = [lancar, macet];
    chartLaporan.update();
  });

  // ======================
  // ğŸ”¹ Chart Sistem (Realtime)
  // ======================
  const chartSistem = new Chart(document.getElementById("chartSistem"), {
    type: "bar",
    data: {
      labels: ["Lancar", "Macet"],
      datasets: [{
        label: "Status Realtime Sistem",
        data: [0, 0],
        backgroundColor: ["#2196f3", "#ff9800"]
      }]
    }
  });

  onValue(ref(db, "traffic/status"), (snapshot) => {
    const data = snapshot.val();
    let lancar = 0, macet = 0;

    if (data) {
      if (data.status === "lancar") lancar = 1;
      if (data.status === "macet") macet = 1;
    }

    chartSistem.data.datasets[0].data = [lancar, macet];
    chartSistem.update();
  });

  // ======================
  // ğŸ”¹ Chart Histori Sistem (Line Chart)
  // ======================
  const chartHistory = new Chart(document.getElementById("chartHistory"), {
    type: "line",
    data: {
      labels: [],
      datasets: [{
        label: "Jumlah Kendaraan",
        data: [],
        borderColor: "#ff5722",
        fill: false
      }]
    }
  });

  onValue(ref(db, "traffic/history"), (snapshot) => {
    const data = snapshot.val();
    let timestamps = [];
    let counts = [];

    if (data) {
      Object.values(data).forEach(item => {
        timestamps.push(item.timestamp);
        counts.push(item.vehicle_count);
      });
    }

    chartHistory.data.labels = timestamps;
    chartHistory.data.datasets[0].data = counts;
    chartHistory.update();
  });
</script>
